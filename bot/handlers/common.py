"""–û–±—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏"""
from aiogram import Router, F
from aiogram.types import Message
from bot.services.role_service import role_service

router = Router(name="common")


@router.message(F.text == "–ü–æ–º–æ—â—å")
async def cmd_help(message: Message, user_role: str):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã '–ü–æ–º–æ—â—å'"""
    
    if user_role == "warehouseman":
        help_text = (
            "<b>üìã –ü–æ–º–æ—â—å –¥–ª—è —Ç–µ—Ö–Ω–∏–∫–∞</b>\n\n"
            "‚Ä¢ <b>–ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏</b> - –ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫ —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏\n"
            "‚Ä¢ <b>–í—Å–µ –∑–∞—è–≤–∫–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è/–Ω–µ–¥–µ–ª—é</b> - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫\n"
            "‚Ä¢ <b>–°–∫–ª–∞–¥</b> - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–º\n"
            "‚Ä¢ <b>–†–∞—Å—Å—ã–ª–∫–∞</b> - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º\n"
            "‚Ä¢ <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b> - –∏–∑–º–µ–Ω–µ–Ω–∏–µ Telegram ID –¥–ª—è —Ä–æ–ª–µ–π\n\n"
            "–ü–æ–¥ –∫–∞–∂–¥–æ–π –∑–∞—è–≤–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è:\n"
            "‚Ä¢ –í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É\n"
            "‚Ä¢ –í—ã–ø–æ–ª–Ω–µ–Ω–æ\n"
            "‚Ä¢ –û—Ç–∫–ª–æ–Ω–∏—Ç—å (—Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã)\n"
            "‚Ä¢ –ù–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"
        )
    elif user_role == "manager":
        help_text = (
            "<b>üìã –ü–æ–º–æ—â—å –¥–ª—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è</b>\n\n"
            "‚Ä¢ <b>–ó–∞—è–≤–∫–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è/–Ω–µ–¥–µ–ª—é</b> - –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫\n"
            "‚Ä¢ <b>–í —Ä–∞–±–æ—Ç–µ > 3/7 –¥–Ω–µ–π</b> - –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—Ç—è–Ω—É–≤—à–∏—Ö—Å—è –∑–∞—è–≤–æ–∫\n"
            "‚Ä¢ <b>–û—Ç—á—ë—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥</b> - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞—è–≤–∫–∞–º\n"
            "‚Ä¢ <b>–ñ–∞–ª–æ–±—ã</b> - –ø—Ä–æ—Å–º–æ—Ç—Ä –∂–∞–ª–æ–± –Ω–∞ —Ç–µ—Ö–Ω–∏–∫–∞\n\n"
            "–í—ã —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∞–µ—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:\n"
            "‚Ä¢ –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ –≤ 9:00 - –æ—Ç—á–µ—Ç –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å\n"
            "‚Ä¢ –ü—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –∂–∞–ª–æ–±\n"
            "‚Ä¢ –ï—Å–ª–∏ —Å—Ä–æ—á–Ω–∞—è –∑–∞—è–≤–∫–∞ > 2 —á–∞—Å–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ '–ù–æ–≤–∞—è'\n"
            "‚Ä¢ –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞—è–≤–∫–∏ –≤ —Ä–∞–±–æ—Ç–µ > 7 –¥–Ω–µ–π"
        )
    else:  # employee
        help_text = (
            "<b>üìã –ü–æ–º–æ—â—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</b>\n\n"
            "‚Ä¢ <b>–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</b> - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ —á–µ—Ä–µ–∑ –ø–æ—à–∞–≥–æ–≤—ã–π –º–∞—Å—Ç–µ—Ä\n"
            "‚Ä¢ <b>–ú–æ–∏ –∑–∞—è–≤–∫–∏</b> - –ø—Ä–æ—Å–º–æ—Ç—Ä –≤–∞—à–∏—Ö –∑–∞—è–≤–æ–∫ –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤\n"
            "‚Ä¢ <b>–°–≤—è–∑–∞—Ç—å—Å—è —Å —Ç–µ—Ö–Ω–∏–∫–æ–º</b> - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ—Ö–Ω–∏–∫—É\n\n"
            "<b>–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏:</b>\n"
            "1. –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é\n"
            "2. –û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ —á—Ç–æ –Ω—É–∂–Ω–æ\n"
            "3. –£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (–µ—Å–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª)\n"
            "4. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç\n"
            "5. –ü—Ä–∏–ª–æ–∂–∏—Ç–µ —Ñ–æ—Ç–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –¥–æ 5 —à—Ç)\n"
            "6. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ\n\n"
            "–í –ª—é–±–æ–π —Å–≤–æ–µ–π –∑–∞—è–≤–∫–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é, –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã."
        )
    
    await message.answer(help_text, parse_mode="HTML")


@router.message(F.text == "–ó–∞–π—Ç–∏ –∫–∞–∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å")
async def reset_to_manager_role(message: Message, base_role: str, user_id: int, db_session, telegram_user):
    """–ó–∞–π—Ç–∏ –∫–∞–∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å (—Å–±—Ä–æ—Å active_role —É –º–µ–Ω–µ–¥–∂–µ—Ä–∞)"""
    if base_role != "manager":
        await message.answer("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.")
        return
    
    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é —Ä–æ–ª—å
    success = await role_service.reset_role(db_session, user_id)
    
    if success:
        # –ü–æ–ª—É—á–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –º–µ–Ω–µ–¥–∂–µ—Ä–∞
        from bot.keyboards.manager import get_manager_keyboard
        
        user_name = telegram_user.first_name or "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
        await message.answer(
            f"‚úÖ –í—ã –≤–æ—à–ª–∏ –∫–∞–∫ <b>–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</b>, {user_name}.\n\n"
            "–í—ã —Å–Ω–æ–≤–∞ –º–æ–∂–µ—Ç–µ:\n"
            "‚Ä¢ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞—è–≤–∫–∏ –∏ –æ—Ç—á–µ—Ç—ã\n"
            "‚Ä¢ –ß–∏—Ç–∞—Ç—å –∂–∞–ª–æ–±—ã –Ω–∞ —Ç–µ—Ö–Ω–∏–∫–∞\n"
            "‚Ä¢ –ü–æ–ª—É—á–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
            reply_markup=get_manager_keyboard(),
            parse_mode="HTML"
        )
    else:
        await message.answer("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Ä–æ–ª–∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è.")

