# Memory Bank: Tasks

## Current Task

**Task ID:** PH11-DEMO-MODE
**Task Name:** Phase 11 — Demo Mode & Multi-Tenant Isolation
**Status:** COMPLETED
**Complexity Level:** 3

## Task Description

Реализация демо-режима для массового тестирования бота:
- Публичный доступ (без allowlist) для демо-режима
- Изоляция данных через tenant_id (каждый пользователь видит только свои данные)
- Ограничение тестового доступа 7 днями
- Управление техниками (назначение техников руководителям)
- Приоритетная логика: техник работает с tenant_id руководителя и не может быть руководителем
- Улучшенное приветственное сообщение с информацией о демо-режиме

## Checklist (High-Level)

- [x] Добавлен DEMO_MODE в конфигурацию
- [x] Реализована изоляция данных через tenant_id (requests, complaints, warehouse_items)
- [x] Добавлена проверка 7 дней доступа в middleware
- [x] Создана модель TechnicianAssignment для связи руководитель-техник
- [x] Реализован сервис TechnicianService для управления техниками
- [x] Добавлены handlers для добавления/удаления/просмотра техников
- [x] Обновлена логика ролей: техник приоритетно работает как warehouseman с tenant_id руководителя
- [x] Обновлено приветственное сообщение с информацией о демо-режиме и оставшихся днях
- [x] Создана миграция для technician_assignments и маркетинговых данных
- [x] Обновлена документация (DEMO_MODE_SETUP.md)

## Implemented (Incremental)

- [x] Переключение ролей для руководителя: "Зайти как пользователь / техник / руководитель"
- [x] Ребрендинг пользовательских текстов: "сотрудник"→"пользователь", "завхоз"→"техник"
- [x] Добавлена env-переменная `BOT_PUBLIC_URL` и ссылка "Протестируйте бота" в /start
- [x] Добавлен DEMO_MODE=true для публичного доступа в демо-режиме
- [x] Реализована изоляция данных через tenant_id (каждый пользователь = свой tenant_id в DEMO_MODE)
- [x] Добавлена проверка срока доступа (7 дней с момента первого /start)
- [x] Создана модель TechnicianAssignment для назначения техников руководителям
- [x] Реализовано управление техниками (добавление/удаление/просмотр списка)
- [x] Техники работают с tenant_id руководителя (видят его заявки и склад)
- [x] Техники принудительно работают как warehouseman (не могут быть руководителями)
- [x] Обновлено приветственное сообщение с информацией о демо-режиме и оставшихся днях
- [x] Добавлена таблица user_events для маркетингового трекинга
- [x] Улучшена обработка username при добавлении техника (с понятными сообщениями об ошибках)


